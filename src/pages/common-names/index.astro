---
import BaseLayout from "../../layouts/app.layout.astro";
import { db, CommonName } from "astro:db";

const commonNames = await db.select().from(CommonName).all();
---

<BaseLayout title="Common Names">
	<div class="p-6">
		<div class="flex justify-between items-center mb-6">
			<h1 class="text-2xl font-bold text-slate-900 dark:text-white">
				Nombres Comunes
			</h1>
			<a
				href="/common-names/create"
				class="bg-purple-700 text-white px-4 py-2 rounded-lg hover:bg-purple-600"
			>
				Agregar Nombre Común
			</a>
		</div>

		<div class="bg-white/25 dark:bg-gray-800/25 rounded-lg shadow">
			<table
				class="min-w-full divide-y divide-gray-200"
				id="default-table"
			>
				<thead class="bg-slate-900 text-white">
					<tr>
						<th>
							<span
								class="px-6 py-3 flex items-center font-medium uppercase tracking-wider"
							>
								Nombre
								<svg
									class="w-4 h-4 ms-1"
									aria-hidden="true"
									xmlns="http://www.w3.org/2000/svg"
									width="24"
									height="24"
									fill="none"
									viewBox="0 0 24 24"
								>
									<path
										stroke="currentColor"
										stroke-linecap="round"
										stroke-linejoin="round"
										stroke-width="2"
										d="m8 15 4 4 4-4m0-6-4-4-4 4"></path>
								</svg>
							</span>
						</th>
						<th>
							<span
								class="px-6 py-3 flex items-center font-medium uppercase tracking-wider"
							>
								Posición
								<svg
									class="w-4 h-4 ms-1"
									aria-hidden="true"
									xmlns="http://www.w3.org/2000/svg"
									width="24"
									height="24"
									fill="none"
									viewBox="0 0 24 24"
								>
									<path
										stroke="currentColor"
										stroke-linecap="round"
										stroke-linejoin="round"
										stroke-width="2"
										d="m8 15 4 4 4-4m0-6-4-4-4 4"></path>
								</svg>
							</span>
						</th>
						<th>
							<span
								class="px-6 py-3 flex items-center font-medium uppercase tracking-wider"
							>
								Activo
								<svg
									class="w-4 h-4 ms-1"
									aria-hidden="true"
									xmlns="http://www.w3.org/2000/svg"
									width="24"
									height="24"
									fill="none"
									viewBox="0 0 24 24"
								>
									<path
										stroke="currentColor"
										stroke-linecap="round"
										stroke-linejoin="round"
										stroke-width="2"
										d="m8 15 4 4 4-4m0-6-4-4-4 4"></path>
								</svg>
							</span>
						</th>
						<th data-type="date" data-format="YYYY/DD/MM">
							<span
								class="px-6 py-3 flex items-center font-medium uppercase tracking-wider"
							>
								Creado
								<svg
									class="w-4 h-4 ms-1"
									aria-hidden="true"
									xmlns="http://www.w3.org/2000/svg"
									width="24"
									height="24"
									fill="none"
									viewBox="0 0 24 24"
								>
									<path
										stroke="currentColor"
										stroke-linecap="round"
										stroke-linejoin="round"
										stroke-width="2"
										d="m8 15 4 4 4-4m0-6-4-4-4 4"></path>
								</svg>
							</span>
						</th>
						<th
							class="px-6 py-3 flex items-center font-medium uppercase tracking-wider"
							>Actions</th
						>
					</tr>
				</thead>
				<tbody class="divide-y divide-slate-300 dark:divide-slate-400">
					{
						commonNames.map((commonName) => (
							<tr>
								<td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900 dark:text-gray-100">
									{commonName.name}
								</td>
								<td class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-900 dark:text-gray-100">
									{commonName.possition}
								</td>
								<td class="px-6 py-4 whitespace-nowrap text-center text-sm text-gray-900 dark:text-gray-100">
									{commonName.active ? "Si" : "No"}
								</td>
								<td class="px-6 py-4 whitespace-nowrap text-sm text-primary-500 dark:text-primary-800">
									{new Date(
										commonName.created_at,
									).toLocaleDateString()}
								</td>
								<td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
									<div
										class="inline-flex rounded-md shadow-sm"
										role="group"
									>
										<a
											href={`/common-names/${commonName.id}/edit`}
											class="
											px-1 
										py-1
										mr-1
										text-sm 
										font-medium 
										border 
										rounded-s-lg 
										focus:z-10 
										focus:ring-2 
										text-gray-100 
										bg-warning-500 
										border-warning-400 
										hover:bg-warning-600 
										focus:ring-orange-400 
										focus:text-gray-100 
										dark:bg-warning-400 
										dark:border-warning-300 
										dark:hover:bg-warning-500 
										dark:focus:ring-orange-500 
										dark:text-white 
										dark:hover:text-white 
										dark:focus:text-white"
										>
											<span class="sr-only">Edit</span>
											<svg
												xmlns="http://www.w3.org/2000/svg"
												class="w-6 h-6"
												aria-hidden="true"
												fill="currentColor"
												viewBox="0 -960 960 960"
											>
												<path d="M200-120q-33 0-56.5-23.5T120-200v-560q0-33 23.5-56.5T200-840h357l-80 80H200v560h560v-278l80-80v358q0 33-23.5 56.5T760-120H200Zm280-360ZM360-360v-170l367-367q12-12 27-18t30-6q16 0 30.5 6t26.5 18l56 57q11 12 17 26.5t6 29.5q0 15-5.5 29.5T897-728L530-360H360Zm481-424-56-56 56 56ZM440-440h56l232-232-28-28-29-28-231 231v57Zm260-260-29-28 29 28 28 28-28-28Z" />
											</svg>
										</a>
										<button
											data-id={commonName.id}
											type="button"
											class="
											px-1 
											py-1
											text-sm 
											font-medium 
											border 
											rounded-e-lg 
											focus:z-10 
											focus:ring-2 
											text-gray-100 
											bg-danger-400 
											border-danger-300
											hover:bg-danger-500 
											focus:ring-orange-600 
											focus:text-gray-100 
											dark:bg-danger-300 
											dark:border-danger-200
											dark:hover:bg-danger-400 
											dark:focus:ring-orange-500
										delete-btn"
										>
											<span class="sr-only">Delete</span>
											<svg
												class="w-6 h-6"
												aria-hidden="true"
												xmlns="http://www.w3.org/2000/svg"
												fill="none"
												viewBox="0 0 24 24"
											>
												<path
													stroke="currentColor"
													stroke-linecap="round"
													stroke-linejoin="round"
													stroke-width="2"
													d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"
												/>
											</svg>
										</button>
									</div>
								</td>
							</tr>
						))
					}
				</tbody>
			</table>
		</div>
	</div>
</BaseLayout>

<script>
	import { DataTable } from "simple-datatables";

	if (
		document.getElementById("default-table") &&
		typeof DataTable !== "undefined"
	) {
		const dataTable = new DataTable("#default-table", {
			searchable: true,
			sortable: true,
			perPage: 5,
			perPageSelect: [5, 10, 15, 20, 25],
		});
	}

	const deleteButtons = document.querySelectorAll(".delete-btn");
	deleteButtons.forEach((button) => {
		button.addEventListener("click", async () => {
			if (confirm("Are you sure you want to delete this common name?")) {
				const id = button.getAttribute("data-id");
				try {
					const response = await fetch(`/api/common-names/${id}`, {
						method: "DELETE",
					});
					if (response.ok) {
						window.location.reload();
					}
				} catch (error) {
					console.error("Error:", error);
				}
			}
		});
	});
</script>
