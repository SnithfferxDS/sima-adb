---
import Layout from "../../layouts/app.layout.astro";
import FileUpload from "../../components/FileUpload.astro";
import BreadCrumbs from "../../components/BreadCrumbs.astro";
import Search from "../../components/Search.astro";

const breadcrumbs = [
	{
		lable: "Tiendas Proveedores",
		path: "/suppliers",
	},
	{
		lable: "Create",
		path: "/suppliers/create",
	},
];
---

<Layout title="Create Supplier">
	<div
		class="shadow-md rounded-lg overflow-hidden transition-shadow hover:shadow-lg"
	>
		<div
			class="p-4 block sm:flex items-center justify-between border-b border-gray-200 lg:mt-1.5"
		>
			<div class="w-full mb-1">
				<BreadCrumbs
					routes={breadcrumbs}
					currentRoute={Astro.url.pathname}
					headerTitle="Create Supplier"
				/>
			</div>
		</div>

		<div class="flex flex-col">
			<div class="overflow-x-auto">
				<div class="inline-block min-w-full align-middle">
					<form
						id="createForm"
						class="max-w-lg bg-gray-50/50 dark:bg-gray-700/50 rounded-lg shadow p-6"
					>
						<div class="mb-4">
							<label
								for="name"
								class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
								>Name</label
							>
							<input
								type="text"
								name="name"
								id="name"
								required
								class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
								placeholder="Supplier Name"
							/>
						</div>

						<div class="grid grid-cols-2 gap-4">
							<div class="mb-4">
								<label
									for="email"
									class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
									>Email</label
								>
								<input
									type="email"
									name="email"
									id="email"
									class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
									placeholder="supplier@example.com"
								/>
							</div>

							<div class="mb-4">
								<label
									for="phone"
									class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
									>Phone</label
								>
								<input
									type="tel"
									name="phone"
									id="phone"
									class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
									placeholder="+1234567890"
								/>
							</div>
						</div>

						<div class="mb-4">
							<label
								for="website"
								class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
								>Website</label
							>
							<input
								type="url"
								name="website"
								id="website"
								class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
								placeholder="https://example.com"
							/>
						</div>

						<div class="mb-4">
							<label
								for="contact"
								class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
								>Contact Person</label
							>
							<input
								type="text"
								name="contact"
								id="contact"
								class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
								placeholder="John Doe"
							/>
						</div>

						<div class="grid grid-cols-2 gap-4">
							<div class="mb-4">
								<label
									for="country"
									class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
									>Country</label
								>
								<input
									type="text"
									name="country"
									id="country"
									class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
									placeholder="Country"
								/>
							</div>

							<div class="mb-4">
								<label
									for="state"
									class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
									>State</label
								>
								<input
									type="text"
									name="state"
									id="state"
									class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
									placeholder="State"
								/>
							</div>
						</div>

						<div class="grid grid-cols-2 gap-4">
							<div class="mb-4">
								<label
									for="city"
									class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
									>City</label
								>
								<input
									type="text"
									name="city"
									id="city"
									class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
									placeholder="City"
								/>
							</div>

							<div class="mb-4">
								<label
									for="street"
									class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
									>Street</label
								>
								<input
									type="text"
									name="street"
									id="street"
									class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
									placeholder="Street"
								/>
							</div>
						</div>

						<div class="grid grid-cols-2 gap-4">
							<div class="mb-4">
								<label
									for="taxes"
									class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
									>Taxes (%)</label
								>
								<input
									type="number"
									name="taxes"
									id="taxes"
									class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
									placeholder="taxes"
									step="0.01"
									value="0.00"
								/>
							</div>

							<div class="mb-4">
								<label
									for="discount"
									class="block mb-2 text-sm font-medium text-gray-900 dark:text-white"
									>Descuento (%)</label
								>
								<input
									type="number"
									name="discount"
									id="discount"
									class="shadow-sm bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-primary-600 focus:border-primary-600 block w-full p-2.5 dark:bg-gray-600 dark:border-gray-500 dark:placeholder-gray-400 dark:text-white dark:focus:ring-primary-500 dark:focus:border-primary-500"
									placeholder="discount"
									step="0.01"
									value="0.00"
								/>
							</div>
						</div>

						<FileUpload id="logo" label="Logo" accept="image/*" />

						<div class="flex justify-end space-x-4">
							<a
								href="/suppliers"
								class="px-4 py-2 text-gray-200 bg-danger-400 rounded-md hover:bg-danger-500"
							>
								Cancel
							</a>
							<button
								type="submit"
								class="px-4 py-2 text-white bg-primary-500 rounded-md hover:bg-primary-600"
							>
								Create
							</button>
						</div>
					</form>
				</div>
			</div>

			<script>
				import {
					showSuccess,
					showError,
				} from "../../lib/utils/notifications";
				import { uploadFile } from "../../lib/utils/upload";

				const form = document.getElementById("createForm");
				form?.addEventListener("submit", async (e) => {
					e.preventDefault();
					const formData = new FormData(form as HTMLFormElement);
					const logoFile = (
						document.getElementById("logo") as HTMLInputElement
					).files?.[0];

					try {
						let logoUrl = null;
						if (logoFile) {
							logoUrl = await uploadFile(logoFile);
						}

						const data = {
							name: formData.get("name"),
							email: formData.get("email"),
							phone: formData.get("phone"),
							website: formData.get("website"),
							contact: formData.get("contact"),
							country: formData.get("country"),
							state: formData.get("state"),
							city: formData.get("city"),
							street: formData.get("street"),
							logo: logoUrl,
							taxes: formData.get("taxes"),
							discount: formData.get("discount"),
						};
						const response = await fetch("/api/suppliers", {
							method: "POST",
							headers: {
								"Content-Type": "application/json",
							},
							body: JSON.stringify(data),
						});

						if (response.ok) {
							showSuccess("Supplier created successfully");
							window.location.href = "/suppliers";
						} else {
							const error = await response.json();
							showError(
								error.message || "Failed to create supplier",
							);
						}
					} catch (error) {
						console.error("Error:", error);
						showError("An unexpected error occurred");
					}
				});
			</script>
		</div>
	</div>
</Layout>
