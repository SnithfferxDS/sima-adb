---
import Layout from '../../../layouts/app.layout.astro';
import FreightCalculator from '../../../components/quotations/FreightCalculator.astro';
import { db, eq, Category, DaiCategoryProduct, Country } from 'astro:db';

// Fetch categories with their DAI information
const categoriesWithDai = await db.select({
    id: Category.id,
    name: Category.name,
    dai: DaiCategoryProduct.dai,
    licenses: DaiCategoryProduct.licenses,
    eco_tax: DaiCategoryProduct.eco_tax,
})
    .from(Category)
    .innerJoin(DaiCategoryProduct, eq(Category.id, DaiCategoryProduct.category_id))
    .where(eq(Category.active, true))
    .orderBy(Category.name);

// Fetch countries
const countries = await db.select().from(Country).orderBy(Country.name);
---

<Layout title="Freight Calculator">
    <div class="max-w-4xl mx-auto">
        <div class="bg-white shadow-md rounded-lg overflow-hidden">
            <div class="p-6 border-b">
                <h1 class="text-2xl font-bold text-gray-900">Freight Calculator</h1>
                <p class="mt-2 text-sm text-gray-600">Calculate shipping costs including taxes and fees</p>
            </div>

            <div class="p-6">
                <FreightCalculator
                        categories={categoriesWithDai}
                        countries={countries}
                />
            </div>
        </div>
    </div>
</Layout>